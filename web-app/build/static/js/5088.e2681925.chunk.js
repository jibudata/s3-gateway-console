(self.webpackChunkportal_ui=self.webpackChunkportal_ui||[]).push([[5088],{75088:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var n=s(72791),r=s(95087),o=s(78687),i=s(57689),l=s(29945);const a="error",c="success",d="inProgress";var x=s(44690),h=s(26824),g=s(87995),u=s(12808),f=s(9478),p=s(31776),j=s(80184);const m=e=>{let{title:t,children:s}=e;const[r,o]=(0,n.useState)("N/A"),[i,a]=(0,n.useState)(0),[c,d]=(0,n.useState)(0),[x,h]=(0,n.useState)(!0);return(0,n.useEffect)((()=>{x&&p.h.admin.adminInfo({defaultOnly:!0}).then((e=>{var t;const s=null===(t=e.data.servers)||void 0===t?void 0:t.length;if(a(s||0),e.data.servers&&e.data.servers.length>0){o(e.data.servers[0].version||"N/A");const t=e.data.servers.reduce(((e,t)=>e+(t.drives?t.drives.length:0)),0);d(t)}h(!1)})).catch((()=>{h(!1)}))}),[x]),(0,j.jsxs)(l.rjZ,{item:!0,xs:12,children:[(0,j.jsx)(l.NZf,{separator:!0,children:t}),(0,j.jsxs)(l.rjZ,{item:!0,xs:12,children:[(0,j.jsx)(l.rjZ,{item:!0,xs:12,sx:{padding:0,marginBottom:25},children:(0,j.jsx)(l.rjZ,{container:!0,sx:{padding:25},children:x?(0,j.jsx)(n.Fragment,{children:(0,j.jsx)(l.rjZ,{item:!0,xs:12,sx:{textAlign:"center"},children:(0,j.jsx)(l.aNw,{style:{width:25,height:25}})})}):(0,j.jsxs)(n.Fragment,{children:[(0,j.jsxs)(l.rjZ,{item:!0,xs:12,md:4,sx:{fontSize:18,display:"flex",alignItems:"center","& svg":{marginRight:10}},children:[(0,j.jsx)(l.FU8,{})," ",(0,j.jsx)("strong",{children:i}),"\xa0nodes,\xa0",(0,j.jsx)("strong",{children:c}),"\xa0 drives"]}),(0,j.jsxs)(l.rjZ,{item:!0,xs:12,md:4,sx:{fontSize:12,justifyContent:"center",alignSelf:"center",alignItems:"center",display:"flex"},children:[(0,j.jsx)("span",{style:{marginRight:20},children:(0,j.jsx)(l.Dbk,{})})," ","MinIO VERSION\xa0",(0,j.jsx)("strong",{children:r})]})]})})}),s]})]})};var w=s(31460),b=s(79844),v=s(99670);const y=()=>{const e=(0,x.TL)(),t=(0,i.s0)(),s=(0,o.v9)((e=>e.healthInfo.message)),p=(0,o.v9)((e=>e.system.serverDiagnosticStatus)),[y,S]=(0,n.useState)(!1),[C,I]=(0,n.useState)(!0),[E,k]=(0,n.useState)(""),[N,Z]=(0,n.useState)("Start Diagnostic"),[D,T]=(0,n.useState)("New Diagnostic"),[_,R]=(0,n.useState)(""),[A,B]=(0,n.useState)(""),F=(0,f.Yc)();(0,n.useEffect)((()=>p===d?(T("Diagnostic in progress..."),void k("Diagnostic started. Please do not refresh page during diagnosis.")):p===c?(T("Diagnostic complete"),k("Diagnostic file is ready to be downloaded."),void Z("Start New Diagnostic")):p===a?(T("Error"),k("An error occurred while getting the Diagnostic file."),void Z("Retry Diagnostic")):void 0),[p,y]),(0,n.useEffect)((()=>{p===c&&s!=={}&&I(!1),p===d&&I(!0),S(!1)}),[p,s]),(0,n.useEffect)((()=>{if(y){e((0,u.Xp)()),R("");const t=new URL(window.location.toString()),s=!1?"9090":t.port,n=(0,h.x2)(t.protocol),o=new URL(document.baseURI).pathname,i=new r.w3cwebsocket("".concat(n,"://").concat(t.hostname,":").concat(s).concat(o,"ws/health-info?deadline=1h"));let l=null;null!==i&&(i.onopen=()=>{console.log("WebSocket Client Connected"),i.send("ok"),l=setInterval((()=>{i.send("ok")}),1e4),k("Diagnostic started. Please do not refresh page during diagnosis."),e((0,g.KY)(d))},i.onmessage=t=>{let s=JSON.parse(t.data.toString());s.serverHealthInfo&&(s.serverHealthInfo.timestamp=new Date(s.serverHealthInfo.timestamp.toString()),e((0,u.ec)(s.serverHealthInfo))),""!==s.encoded&&R(s.encoded),s.subnetResponse&&B(s.subnetResponse)},i.onerror=t=>{console.log("error closing websocket:",t.message),i.close(1e3),clearInterval(l),e((0,g.KY)(a))},i.onclose=t=>{clearInterval(l),t.code===h.HE||t.code===h.ci||t.code===h.V9?(console.log("connection closed by server with code:",t.code),k("An error occurred while getting the Diagnostic file."),e((0,g.KY)(a))):(console.log("connection closed by server"),k("Diagnostic file is ready to be downloaded."),e((0,g.KY)(c)))})}else S(!1)}),[y,e]);return(0,n.useEffect)((()=>{e((0,g.Sc)("health_info"))}),[e]),(0,j.jsxs)(n.Fragment,{children:[(0,j.jsx)(b.Z,{label:"Health",actions:(0,j.jsx)(v.Z,{})}),(0,j.jsxs)(l.Xgh,{children:[!F&&(0,j.jsx)(w.Z,{compactMode:!0}),(0,j.jsx)(l.xuv,{withBorders:!0,children:(0,j.jsx)(m,{title:D,children:(0,j.jsx)(l.rjZ,{container:!0,sx:{justifyContent:"flex-start",gap:20},children:(0,j.jsxs)(l.rjZ,{item:!0,xs:12,sx:{textAlign:"center",marginBottom:25},children:[(0,j.jsx)("h2",{children:E}),(0,j.jsxs)(l.xuv,{sx:{textAlign:"center",marginBottom:25},children:[" ",""!==A&&!A.toLowerCase().includes("error")&&(0,j.jsxs)(l.rjZ,{item:!0,xs:12,children:[(0,j.jsx)("strong",{children:"Health report uploaded to SUBNET successfully!"}),"\xa0"," ",(0,j.jsxs)("strong",{children:["See the results on your"," ",(0,j.jsx)("a",{href:A,children:"SUBNET Dashboard"})," "]})]}),(""===A||A.toLowerCase().includes("error"))&&p===c&&(0,j.jsxs)(l.rjZ,{item:!0,xs:12,children:[(0,j.jsx)("strong",{children:"Something went wrong uploading your Health report to SUBNET."}),"\xa0"," ",(0,j.jsxs)("strong",{children:["Log into your"," ",(0,j.jsx)("a",{href:"https://subnet.min.io",children:"SUBNET Account"})," to manually upload your Health report."]})]})]}),p===d?(0,j.jsx)(l.xuv,{sx:{paddingTop:8,paddingLeft:40},children:(0,j.jsx)(l.aNw,{style:{width:25,height:25}})}):(0,j.jsx)(n.Fragment,{children:(0,j.jsxs)(l.xuv,{sx:{display:"flex",gap:10,alignItems:"center",justifyContent:"center"},children:[(0,j.jsx)(l.xuv,{children:p!==a&&!C&&(0,j.jsx)(l.zxk,{id:"download",type:"submit",variant:"callAction",onClick:()=>(()=>{let e=document.createElement("a");e.setAttribute("href","data:application/gzip;base64,".concat(_)),e.setAttribute("download","diagnostic.json.gz"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)})(),disabled:C,label:"Download"})}),(0,j.jsx)(l.xuv,{children:(0,j.jsx)(l.zxk,{id:"start-new-diagnostic",type:"submit",variant:F?"callAction":"regular",disabled:y||!F,onClick:()=>{F?S(!0):t("/support/register")},label:N})})]})})]},"start-download")})})}),!y&&F&&(0,j.jsxs)(n.Fragment,{children:[(0,j.jsx)("br",{}),(0,j.jsx)(l.KfX,{title:"Cluster Health Report will be uploaded to SUBNET, and is viewable from your SUBNET Diagnostics dashboard.",iconComponent:(0,j.jsx)(l.szr,{}),help:"If the Health report cannot be generated at this time, please wait a moment and try again."})]})]})]})}},31460:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var n=s(72791),r=s(57689),o=s(29945),i=s(80184);const l=e=>{let{compactMode:t=!1}=e;const s=(0,r.s0)(),l=(0,i.jsx)(o.zxk,{id:"go-to-register",type:"submit",variant:"callAction",color:"primary",onClick:()=>s("/support/register"),children:"Register your Cluster"}),a="Please use your MinIO Subscription Network login credentials to register this cluster and enable this feature.";return t?(0,i.jsxs)(n.Fragment,{children:[(0,i.jsx)(o.rjZ,{sx:{"& div.leftItems":{marginBottom:0}},children:(0,i.jsx)(o.KfX,{title:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexGrow:1},children:[(0,i.jsx)("span",{children:a})," ",l]}),iconComponent:(0,i.jsx)(o.e6P,{}),help:null})}),(0,i.jsx)("br",{})]}):(0,i.jsx)(o.xuv,{sx:{padding:"25px",border:"1px solid #eaeaea",display:"flex",alignItems:"center",justifyContent:"center",flexFlow:"row",marginBottom:"15px",["@media (max-width: ".concat(o.Egj.sm,"px)")]:{flexFlow:"column"}},children:(0,i.jsxs)(o.rjZ,{container:!0,children:[(0,i.jsx)(o.rjZ,{item:!0,xs:12,children:(0,i.jsx)(o.xuv,{sx:{marginRight:"8px",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center","& .min-icon":{width:"83px",height:"14px",marginLeft:"5px",marginRight:"5px"}},children:"Register your cluster"})}),(0,i.jsx)(o.rjZ,{item:!0,xs:12,children:(0,i.jsx)(o.xuv,{sx:{display:"flex",flexFlow:"row",["@media (max-width: ".concat(o.Egj.sm,"px)")]:{flexFlow:"column"}},children:(0,i.jsxs)(o.xuv,{sx:{display:"flex",flexFlow:"column",flex:"2"},children:[(0,i.jsx)(o.xuv,{sx:{fontSize:"16px",display:"flex",flexFlow:"column",marginTop:"15px",marginBottom:"15px"},children:a}),(0,i.jsx)(o.xuv,{sx:{flex:"1"},children:(0,i.jsx)(o.xuv,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:l})})]})})})]})})}},94210:e=>{var t=function(){if("object"===typeof self&&self)return self;if("object"===typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"===typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return t()}try{return __global__||t()}finally{delete Object.prototype.__global__}}()},95087:(e,t,s)=>{var n;if("object"===typeof globalThis)n=globalThis;else try{n=s(94210)}catch(l){}finally{if(n||"undefined"===typeof window||(n=window),!n)throw new Error("Could not determine global this")}var r=n.WebSocket||n.MozWebSocket,o=s(51496);function i(e,t){return t?new r(e,t):new r(e)}r&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(i,e,{get:function(){return r[e]}})})),e.exports={w3cwebsocket:r?i:null,version:o}},51496:(e,t,s)=>{e.exports=s(19794).version},19794:e=>{"use strict";e.exports={version:"1.0.34"}}}]);
//# sourceMappingURL=5088.e2681925.chunk.js.map