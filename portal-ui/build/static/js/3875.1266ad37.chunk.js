"use strict";(self.webpackChunkportal_ui=self.webpackChunkportal_ui||[]).push([[3875],{93875:function(e,n,i){i.r(n),i.d(n,{default:function(){return k}});var t=i(93433),r=i(4942),s=i(1413),c=i(29439),a=i(72791),o=i(57689),d=i(29945),l=i(9505),u=i(56087),x=i(87995),p=i(44690),f=i(78687),h=i(46078),g=i(27454),j=i(80184),v=function(e){var n=e.rowData,i=e.rowId,t=e.onFieldChange,r=e.onAddClick,s=e.onRemoveClick,c=e.canAdd,o=void 0===c||c,l=e.canRemove,u=void 0===l||l,x=e.showRowActions,p=void 0===x||x,f=e.disabledFields,h=void 0===f?[]:f,v=e.fieldErrors,m=void 0===v?{}:v,y=n.endpoint,K=void 0===y?"":y,C=n.accessKey,w=void 0===C?"":C,b=n.secretKey,k=void 0===b?"":b,Z=n.name,S=void 0===Z?"":Z;return(0,j.jsxs)(a.Fragment,{children:[(0,j.jsx)(d.xuv,{children:(0,j.jsx)(d.Wzg,{id:"add-rep-peer-site-".concat(i),name:"add-rep-peer-site-".concat(i),placeholder:"site-name",label:"",readOnly:h.includes("name"),value:S,onChange:function(e){t(e,"name",i)},"data-test-id":"add-site-rep-peer-site-".concat(i)})}),(0,j.jsx)(d.xuv,{children:(0,j.jsx)(d.Wzg,{id:"add-rep-peer-site-ep-".concat(i),name:"add-rep-peer-site-ep-".concat(i),placeholder:"https://dr.minio-storage:900".concat(i),label:"",readOnly:h.includes("endpoint"),error:m.endpoint,value:K,onChange:function(e){t(e,"endpoint",i)},"data-test-id":"add-site-rep-peer-ep-".concat(i)})}),(0,j.jsx)(d.xuv,{children:(0,j.jsx)(d.Wzg,{id:"add-rep-peer-site-ac-".concat(i),name:"add-rep-peer-site-ac-".concat(i),label:"",required:!0,disabled:h.includes("accessKey"),value:w,error:m.accessKey,onChange:function(e){t(e,"accessKey",i)},"data-test-id":"add-rep-peer-site-ac-".concat(i)})}),(0,j.jsx)(d.xuv,{children:(0,j.jsx)(d.Wzg,{id:"add-rep-peer-site-sk-".concat(i),name:"add-rep-peer-site-sk-".concat(i),label:"",required:!0,type:"password",value:k,error:m.secretKey,disabled:h.includes("secretKey"),onChange:function(e){t(e,"secretKey",i)},"data-test-id":"add-rep-peer-site-sk-".concat(i)})}),(0,j.jsx)(d.rjZ,{item:!0,xs:12,sx:{alignItems:"center",display:"flex"},children:(0,j.jsx)(d.xuv,{sx:{display:"flex",alignItems:"center",justifyContent:"center",alignSelf:"baseline",marginTop:"4px","& button":{borderColor:"#696969",color:"#696969",borderRadius:"50%"}},children:p?(0,j.jsxs)(a.Fragment,{children:[(0,j.jsx)(g.Z,{tooltip:"Add a Row",children:(0,j.jsx)(d.zxk,{id:"add-row-".concat(i),variant:"regular",disabled:!o,icon:(0,j.jsx)(d.dtP,{}),onClick:function(e){e.preventDefault(),null===r||void 0===r||r(i)},style:{width:25,height:25,padding:0}})}),(0,j.jsx)(g.Z,{tooltip:"Remove Row",children:(0,j.jsx)(d.zxk,{id:"remove-row-".concat(i),variant:"regular",disabled:!u,icon:(0,j.jsx)(d.HFL,{}),onClick:function(e){e.preventDefault(),null===s||void 0===s||s(i)},style:{width:25,height:25,padding:0,marginLeft:8}})})]}):null})})]},"".concat(i))},m=i(47974),y=i(99670),K=function(e){var n=!1;try{new URL(e),n=!0}catch(i){n=!1}return n?"":"Invalid Endpoint"},C=function(e){return""===(null===e||void 0===e?void 0:e.trim())},w=function(){return(0,j.jsxs)(a.Fragment,{children:[(0,j.jsx)(d.xuv,{children:(0,j.jsx)(d.AZs,{children:"Site Name"})}),(0,j.jsx)(d.xuv,{children:(0,j.jsxs)(d.AZs,{children:["Endpoint ","*"]})}),(0,j.jsx)(d.xuv,{children:(0,j.jsxs)(d.AZs,{children:["Access Key ","*"]})}),(0,j.jsx)(d.xuv,{children:(0,j.jsxs)(d.AZs,{children:["Secret Key ","*"]})}),(0,j.jsx)(d.xuv,{children:" "})]})},b=function(e){var n=e.title;return(0,j.jsx)(d.rjZ,{item:!0,xs:12,children:(0,j.jsx)(d.xuv,{sx:{marginBottom:"15px",fontSize:"14px",fontWeight:600},children:n})})},k=function(){var e=(0,p.TL)(),n=(0,o.s0)(),i=(0,f.v9)(h.gK).serverEndPoint,g=void 0===i?"":i,k=(0,a.useState)([{endpoint:g,name:"",accessKey:"",secretKey:""}]),Z=(0,c.Z)(k,2),S=Z[0],T=Z[1],A=(0,a.useState)([]),I=(0,c.Z)(A,2),R=I[0],E=I[1],B=function(){E([{endpoint:"",name:"",accessKey:"",secretKey:""}])},z=(0,l.Z)((function(e){var n=e.sites,i=e.name,t=n.findIndex((function(e){return e.name===i}));if(-1!==t){var r=n[t];r=(0,s.Z)((0,s.Z)({},r),{},{isCurrent:!0,isSaved:!0}),T([r]),n.splice(t,1)}n.sort((function(e,n){return e.name===i?-1:n.name===i?1:0}));var c=n.map((function(e){return(0,s.Z)((0,s.Z)({},e),{},{accessKey:"",secretKey:"",isSaved:!0})}));c.length?E(c):B()}),(function(e){B()})),F=(0,c.Z)(z,2),L=F[0],W=F[1],q=function(){W("GET","api/v1/admin/site-replication")};(0,a.useEffect)((function(){q()}),[]),(0,a.useEffect)((function(){e((0,x.Sc)("add-replication-sites"))}),[]);var O=R.reduce((function(e,n,i){var t=R[i].endpoint,r=K(t);return""===r&&""!==t&&e.push(r),e}),[]),P=R.map((function(e){return!C(e.accessKey)&&!C(e.secretKey)})).filter(Boolean),D=S[0],N=D.accessKey,_=D.secretKey,H=!C(N)&&!C(_),M=O.length===R.length,X=P.length===R.length,Y=H&&M&&X,G=(0,l.Z)((function(i){i.success?(e((0,x.y1)(i.status)),Q(),q(),n(u.gA.SITE_REPLICATION)):e((0,x.Ih)({errorMessage:"Error",detailedError:i.status}))}),(function(n){e((0,x.Ih)(n))})),U=(0,c.Z)(G,2),V=U[0],J=U[1],Q=function(){B(),T((function(e){return e.map((function(e,n){return(0,s.Z)((0,s.Z)({},e),{},{accessKey:"",secretKey:"",name:""})}))}))};return(0,j.jsxs)(a.Fragment,{children:[(0,j.jsx)(m.Z,{label:(0,j.jsx)(d.hbI,{label:"Add Replication Site",onClick:function(){return n(u.gA.SITE_REPLICATION)}}),actions:(0,j.jsx)(y.Z,{})}),(0,j.jsx)(d.Xgh,{children:(0,j.jsxs)(d.xuv,{sx:{display:"grid",padding:"25px",gap:"25px",gridTemplateColumns:"1fr",border:"1px solid #eaeaea"},children:[(0,j.jsxs)(d.xuv,{children:[(0,j.jsx)(d.NZf,{separator:!0,icon:(0,j.jsx)(d.aWt,{}),children:"Add Sites for Replication"}),L||V?(0,j.jsx)(d.kod,{}):null,(0,j.jsx)(d.xuv,{sx:{fontSize:"14px",fontStyle:"italic",marginTop:"10px",marginBottom:"10px"},children:"Note: AccessKey and SecretKey values for every site is required while adding or editing peer sites"}),(0,j.jsxs)("form",{noValidate:!0,autoComplete:"off",onSubmit:function(e){return e.preventDefault(),function(){var e=null===S||void 0===S?void 0:S.map((function(e,n){return{accessKey:e.accessKey,secretKey:e.secretKey,name:e.name,endpoint:e.endpoint.trim()}})),n=R.reduce((function(e,n,i){return n.endpoint&&e.push({accessKey:n.accessKey,secretKey:n.secretKey,name:n.name||"dr-site-".concat(i),endpoint:n.endpoint.trim()}),e}),[]),i=e.concat(n);J("POST","api/v1/admin/site-replication",i)}()},children:[(0,j.jsxs)(d.xuv,{sx:{marginTop:"15px"},children:[(0,j.jsx)(b,{title:"This Site"}),(0,j.jsxs)(d.xuv,{withBorders:!0,sx:{display:"grid",gridTemplateColumns:".8fr 1.2fr .8fr .8fr .2fr",padding:"15px",gap:"10px",maxHeight:"430px",overflowY:"auto"},children:[(0,j.jsx)(w,{}),S.map((function(e,n){var i=C(e.accessKey)?"AccessKey is required":"",t=C(e.secretKey)?"SecretKey is required":"";return(0,j.jsx)(v,{rowData:e,rowId:n,fieldErrors:{accessKey:i,secretKey:t},onFieldChange:function(e,n,i){var t=e.target.value;""!==n&&T((function(e){return e.map((function(e,c){return c===i?(0,s.Z)((0,s.Z)({},e),{},(0,r.Z)({},n,t)):e}))}))},showRowActions:!1},"current-".concat(n))}))]})]}),(0,j.jsxs)(d.xuv,{sx:{marginTop:"25px"},children:[(0,j.jsx)(b,{title:"Peer Sites"}),(0,j.jsxs)(d.xuv,{withBorders:!0,sx:{display:"grid",gridTemplateColumns:".8fr 1.2fr .8fr .8fr .2fr",padding:"15px",gap:"10px",maxHeight:"430px",overflowY:"auto"},children:[(0,j.jsx)(w,{}),R.map((function(e,n){var i=K(e.endpoint),c=C(e.accessKey)?"AccessKey is required":"",a=C(e.secretKey)?"SecretKey is required":"";return(0,j.jsx)(v,{rowData:e,rowId:n,fieldErrors:{endpoint:i,accessKey:c,secretKey:a},onFieldChange:function(e,n,i){var t=e.target.value;E((function(e){return e.map((function(e,c){return c===i?(0,s.Z)((0,s.Z)({},e),{},(0,r.Z)({},n,t)):e}))}))},canAdd:!0,canRemove:n>0&&!e.isSaved,onAddClick:function(){var e=(0,t.Z)(R);e.splice(n+1,0,{name:"",endpoint:"",accessKey:"",secretKey:""}),E(e)},onRemoveClick:function(e){E(R.filter((function(n,i){return i!==e})))}},"exiting-".concat(n))}))]})]}),(0,j.jsx)(d.rjZ,{item:!0,xs:12,children:(0,j.jsxs)(d.xuv,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",marginTop:"20px",gap:"15px"},children:[(0,j.jsx)(d.zxk,{id:"clear",type:"button",variant:"regular",disabled:V,onClick:Q,label:"Clear"}),(0,j.jsx)(d.zxk,{id:"save",type:"submit",variant:"callAction",disabled:V||!Y,label:"Save"})]})})]})]}),(0,j.jsx)(d.KfX,{title:"",iconComponent:null,help:(0,j.jsxs)(a.Fragment,{children:[(0,j.jsxs)(d.xuv,{sx:{marginTop:"-25px",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"2px"},children:[(0,j.jsx)(d.xuv,{sx:{backgroundColor:"#07193E",height:"15px",width:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",marginRight:"18px",padding:"3px",paddingLeft:"2px","& .min-icon":{height:"11px",width:"11px",fill:"#ffffff"}},children:(0,j.jsx)(d.aWt,{})}),"About Site Replication"]}),(0,j.jsxs)(d.xuv,{sx:{display:"flex",flexFlow:"column",fontSize:"14px",flex:"2","& li":{fontSize:"14px",display:"flex",marginTop:"15px",marginBottom:"15px",width:"100%","&.step-text":{fontWeight:400}}},children:[(0,j.jsx)(d.xuv,{children:"The following changes are replicated to all other sites"}),(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"Creation and deletion of buckets and objects"}),(0,j.jsx)("li",{children:"Creation and deletion of all IAM users, groups, policies and their mappings to users or groups"}),(0,j.jsx)("li",{children:"Creation of STS credentials"}),(0,j.jsx)("li",{children:"Creation and deletion of service accounts (except those owned by the root user)"}),(0,j.jsx)("li",{children:(0,j.jsxs)(d.xuv,{style:{display:"flex",flexFlow:"column",justifyContent:"flex-start"},children:[(0,j.jsx)("div",{style:{paddingTop:"1px"},children:"Changes to Bucket features such as"}),(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"Bucket Policies"}),(0,j.jsx)("li",{children:"Bucket Tags"}),(0,j.jsx)("li",{children:"Bucket Object-Lock configurations"}),(0,j.jsx)("li",{children:"Bucket Encryption configuration"})]})]})}),(0,j.jsx)("li",{children:(0,j.jsxs)(d.xuv,{style:{display:"flex",flexFlow:"column",justifyContent:"flex-start"},children:[(0,j.jsx)("div",{style:{paddingTop:"1px"},children:"The following Bucket features will NOT be replicated"}),(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"Bucket notification configuration"}),(0,j.jsx)("li",{children:"Bucket lifecycle (ILM) configuration"})]})]})})]})]})]})})]})})]})}}}]);
//# sourceMappingURL=3875.1266ad37.chunk.js.map