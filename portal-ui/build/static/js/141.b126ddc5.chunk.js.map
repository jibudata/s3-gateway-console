{"version":3,"sources":["screens/Console/Common/FormComponents/PredefinedList/PredefinedList.tsx","screens/Console/Policies/SetPolicy.tsx"],"names":["withStyles","theme","createStyles","predefinedList","classes","label","content","multiLine","className","prefinedContainer","item","xs","predefinedTitle","innerContentMultiline","innerContent","mapDispatchToProps","setModalErrorSnackMessage","connector","connect","modalBasic","spacingUtils","tableBlock","tableStyles","marginTop","buttonContainer","textAlign","closeModalAndRefresh","selectedUser","selectedGroup","open","useState","loading","setLoading","actualPolicy","setActualPolicy","selectedPolicy","setSelectedPolicy","useEffect","api","invoke","encodeURI","then","res","groupPolicy","get","split","catch","err","userPolicy","userName","onClose","modalOpen","title","join","type","variant","color","spacerRight","onClick","disabled","entity","value","accessKey","name","entityName","entityType"],"mappings":"6KAiDeA,iBAnCA,SAACC,GAAD,OACbC,YAAa,eACRC,QAiCQH,EA9BQ,SAAC,GAKA,IAJtBI,EAIqB,EAJrBA,QAIqB,IAHrBC,aAGqB,MAHb,GAGa,EAFrBC,EAEqB,EAFrBA,QAEqB,IADrBC,iBACqB,SACrB,OACE,cAAC,WAAD,UACE,eAAC,IAAD,CAAMC,UAAWJ,EAAQK,kBAAzB,UACa,KAAVJ,GACC,cAAC,IAAD,CAAMK,MAAI,EAACC,GAAI,GAAIH,UAAWJ,EAAQQ,gBAAtC,SACGP,IAGL,cAAC,IAAD,CAAMK,MAAI,EAACC,GAAI,GAAIH,UAAWJ,EAAQD,eAAtC,SACE,cAAC,IAAD,CACEO,MAAI,EACJC,GAAI,GACJH,UACED,EAAYH,EAAQS,sBAAwBT,EAAQU,aAJxD,SAOGR,e,mMCyJPS,EAAqB,CACzBC,+BAGIC,EAAYC,YAAQ,KAAMH,GAEjBf,uBA1JA,SAACC,GAAD,OACbC,YAAa,uCACRiB,KACAC,KAFO,IAGVC,WAAW,2BACNC,IAAYD,YADP,IAERE,UAAW,KAEbC,gBAAiB,CACfC,UAAW,QACXF,UAAW,cAgJFvB,CAAmBiB,GA5IhB,SAAC,GAOK,IANtBb,EAMqB,EANrBA,QACAsB,EAKqB,EALrBA,qBACAC,EAIqB,EAJrBA,aACAC,EAGqB,EAHrBA,cACAZ,EAEqB,EAFrBA,0BACAa,EACqB,EADrBA,KAGA,EAA8BC,oBAAkB,GAAhD,mBAAOC,EAAP,KAAgBC,EAAhB,KACA,EAAwCF,mBAAmB,IAA3D,mBAAOG,EAAP,KAAqBC,EAArB,KACA,EAA4CJ,mBAAmB,IAA/D,mBAAOK,EAAP,KAAuBC,EAAvB,KAoDAC,qBAAU,WACR,GAAIR,EAAM,CACR,GAAsB,OAAlBD,EAEF,YAvBAA,GACFU,IACGC,OAAO,MADV,6BACuCC,UAAUZ,KAC9Ca,MAAK,SAACC,GACL,IAAMC,EAAsBC,IAAIF,EAAK,SAAU,IAC/CR,EAAgBS,EAAYE,MAAM,MAClCT,EAAkBO,EAAYE,MAAM,SAErCC,OAAM,SAACC,GACN/B,EAA0B+B,GAC1Bf,GAAW,OAgBf,IAAMgB,EAAuBJ,IAAIjB,EAAc,SAAU,IACzDO,EAAgBc,GAChBZ,EAAkBY,MAGnB,CAACnB,EAAMD,EAAeD,IAEzB,IAAMsB,EAAWL,IAAIjB,EAAc,YAAa,IAEhD,OACE,eAAC,IAAD,CACEuB,QAAS,WACPxB,KAEFyB,UAAWtB,EACXuB,MAAM,eALR,UAOE,cAAC,IAAD,CAAM1C,MAAI,EAACC,GAAI,GAAf,SACE,cAAC,IAAD,CACEN,MAAK,mBAAgC,OAAlBuB,EAAyB,QAAU,QACtDtB,QAA2B,OAAlBsB,EAAyBA,EAAgBqB,MAGtD,cAAC,IAAD,CAAMvC,MAAI,EAACC,GAAI,GAAf,SACE,cAAC,IAAD,CACEN,MAAO,iBACPC,QAAS2B,EAAaoB,KAAK,UAG/B,qBAAK7C,UAAWJ,EAAQiB,WAAxB,SACE,cAAC,IAAD,CACEc,eAAgBA,EAChBC,kBAAmBA,MAGvB,eAAC,IAAD,CAAM1B,MAAI,EAACC,GAAI,GAAIH,UAAWJ,EAAQoB,gBAAtC,UACE,cAAC,IAAD,CACE8B,KAAK,SACLC,QAAQ,WACRC,MAAM,UACNhD,UAAWJ,EAAQqD,YACnBC,QApDe,WACrBtB,EAAkBH,IA8Cd,mBASA,cAAC,IAAD,CACEqB,KAAK,SACLC,QAAQ,YACRC,MAAM,UACNG,SAAU5B,EACV2B,QA3GgB,WACtB,IAAIE,EAAS,OACTC,EAAQ,KACU,OAAlBjC,GACFgC,EAAS,QACTC,EAAQjC,GAEa,OAAjBD,IACFkC,EAAQlC,EAAamC,WAIzB9B,GAAW,GAEXM,IACGC,OAAO,MADV,qBACuC,CACnCwB,KAAM5B,EACN6B,WAAYH,EACZI,WAAYL,IAEbnB,MAAK,WACJT,GAAW,GACXN,OAEDoB,OAAM,SAACC,GACNf,GAAW,GACXhB,EAA0B+B,OA4E1B,qBAUDhB,GACC,cAAC,IAAD,CAAMrB,MAAI,EAACC,GAAI,GAAf,SACE,cAAC,IAAD","file":"static/js/141.b126ddc5.chunk.js","sourcesContent":["import React, { Fragment } from \"react\";\nimport Grid from \"@mui/material/Grid\";\nimport { Theme } from \"@mui/material/styles\";\nimport createStyles from \"@mui/styles/createStyles\";\nimport withStyles from \"@mui/styles/withStyles\";\nimport { predefinedList } from \"../common/styleLibrary\";\n\ninterface IPredefinedList {\n  classes: any;\n  label?: string;\n  content: any;\n  multiLine?: boolean;\n}\n\nconst styles = (theme: Theme) =>\n  createStyles({\n    ...predefinedList,\n  });\n\nconst PredefinedList = ({\n  classes,\n  label = \"\",\n  content,\n  multiLine = false,\n}: IPredefinedList) => {\n  return (\n    <Fragment>\n      <Grid className={classes.prefinedContainer}>\n        {label !== \"\" && (\n          <Grid item xs={12} className={classes.predefinedTitle}>\n            {label}\n          </Grid>\n        )}\n        <Grid item xs={12} className={classes.predefinedList}>\n          <Grid\n            item\n            xs={12}\n            className={\n              multiLine ? classes.innerContentMultiline : classes.innerContent\n            }\n          >\n            {content}\n          </Grid>\n        </Grid>\n      </Grid>\n    </Fragment>\n  );\n};\n\nexport default withStyles(styles)(PredefinedList);\n","// This file is part of MinIO Console Server\n// Copyright (c) 2021 MinIO, Inc.\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\nimport React, { useEffect, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport get from \"lodash/get\";\nimport { Theme } from \"@mui/material/styles\";\nimport createStyles from \"@mui/styles/createStyles\";\nimport withStyles from \"@mui/styles/withStyles\";\nimport { Button, LinearProgress } from \"@mui/material\";\nimport Grid from \"@mui/material/Grid\";\nimport {\n  modalBasic,\n  spacingUtils,\n  tableStyles,\n} from \"../Common/FormComponents/common/styleLibrary\";\nimport { User } from \"../Users/types\";\nimport { setModalErrorSnackMessage } from \"../../../actions\";\nimport { ErrorResponseHandler } from \"../../../common/types\";\nimport ModalWrapper from \"../Common/ModalWrapper/ModalWrapper\";\nimport api from \"../../../common/api\";\nimport PolicySelectors from \"./PolicySelectors\";\nimport PredefinedList from \"../Common/FormComponents/PredefinedList/PredefinedList\";\n\ninterface ISetPolicyProps {\n  classes: any;\n  closeModalAndRefresh: () => void;\n  selectedUser: User | null;\n  selectedGroup: string | null;\n  open: boolean;\n  setModalErrorSnackMessage: typeof setModalErrorSnackMessage;\n}\n\nconst styles = (theme: Theme) =>\n  createStyles({\n    ...modalBasic,\n    ...spacingUtils,\n    tableBlock: {\n      ...tableStyles.tableBlock,\n      marginTop: 15,\n    },\n    buttonContainer: {\n      textAlign: \"right\",\n      marginTop: \".9rem\",\n    },\n  });\n\nconst SetPolicy = ({\n  classes,\n  closeModalAndRefresh,\n  selectedUser,\n  selectedGroup,\n  setModalErrorSnackMessage,\n  open,\n}: ISetPolicyProps) => {\n  //Local States\n  const [loading, setLoading] = useState<boolean>(false);\n  const [actualPolicy, setActualPolicy] = useState<string[]>([]);\n  const [selectedPolicy, setSelectedPolicy] = useState<string[]>([]);\n\n  const setPolicyAction = () => {\n    let entity = \"user\";\n    let value = null;\n    if (selectedGroup !== null) {\n      entity = \"group\";\n      value = selectedGroup;\n    } else {\n      if (selectedUser !== null) {\n        value = selectedUser.accessKey;\n      }\n    }\n\n    setLoading(true);\n\n    api\n      .invoke(\"PUT\", `/api/v1/set-policy`, {\n        name: selectedPolicy,\n        entityName: value,\n        entityType: entity,\n      })\n      .then(() => {\n        setLoading(false);\n        closeModalAndRefresh();\n      })\n      .catch((err: ErrorResponseHandler) => {\n        setLoading(false);\n        setModalErrorSnackMessage(err);\n      });\n  };\n\n  const fetchGroupInformation = () => {\n    if (selectedGroup) {\n      api\n        .invoke(\"GET\", `/api/v1/group?name=${encodeURI(selectedGroup)}`)\n        .then((res: any) => {\n          const groupPolicy: String = get(res, \"policy\", \"\");\n          setActualPolicy(groupPolicy.split(\",\"));\n          setSelectedPolicy(groupPolicy.split(\",\"));\n        })\n        .catch((err: ErrorResponseHandler) => {\n          setModalErrorSnackMessage(err);\n          setLoading(false);\n        });\n    }\n  };\n\n  const resetSelection = () => {\n    setSelectedPolicy(actualPolicy);\n  };\n\n  useEffect(() => {\n    if (open) {\n      if (selectedGroup !== null) {\n        fetchGroupInformation();\n        return;\n      }\n\n      const userPolicy: string[] = get(selectedUser, \"policy\", []);\n      setActualPolicy(userPolicy);\n      setSelectedPolicy(userPolicy);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [open, selectedGroup, selectedUser]);\n\n  const userName = get(selectedUser, \"accessKey\", \"\");\n\n  return (\n    <ModalWrapper\n      onClose={() => {\n        closeModalAndRefresh();\n      }}\n      modalOpen={open}\n      title=\"Set Policies\"\n    >\n      <Grid item xs={12}>\n        <PredefinedList\n          label={`Selected ${selectedGroup !== null ? \"Group\" : \"User\"}`}\n          content={selectedGroup !== null ? selectedGroup : userName}\n        />\n      </Grid>\n      <Grid item xs={12}>\n        <PredefinedList\n          label={\"Current Policy\"}\n          content={actualPolicy.join(\", \")}\n        />\n      </Grid>\n      <div className={classes.tableBlock}>\n        <PolicySelectors\n          selectedPolicy={selectedPolicy}\n          setSelectedPolicy={setSelectedPolicy}\n        />\n      </div>\n      <Grid item xs={12} className={classes.buttonContainer}>\n        <Button\n          type=\"button\"\n          variant=\"outlined\"\n          color=\"primary\"\n          className={classes.spacerRight}\n          onClick={resetSelection}\n        >\n          Reset\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"contained\"\n          color=\"primary\"\n          disabled={loading}\n          onClick={setPolicyAction}\n        >\n          Save\n        </Button>\n      </Grid>\n      {loading && (\n        <Grid item xs={12}>\n          <LinearProgress />\n        </Grid>\n      )}\n    </ModalWrapper>\n  );\n};\n\nconst mapDispatchToProps = {\n  setModalErrorSnackMessage,\n};\n\nconst connector = connect(null, mapDispatchToProps);\n\nexport default withStyles(styles)(connector(SetPolicy));\n"],"sourceRoot":""}